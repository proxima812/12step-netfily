---
import SpechPlayer from '@components/SpechPlayer.astro'
import AsidePost from '@components/sidebars/AsidePost.astro'
import PrevPosts from '@components/sidebars/PrevPosts.astro'
import ReadingTime from '@components/sidebars/ReadingTime'
import Post from '@layouts/Post.astro'
import { CollectionEntry, getCollection } from 'astro:content'

export async function getStaticPaths() {
  const allPosts = await getCollection('dzho-i-charli')
  const numberOfPosts = allPosts.length
  return allPosts
    .sort((a, b) => a.id.length - b.id.length)
    .map((post, i) => ({
      params: { slug: post.slug },
      props: {
        post,
        // Previous post
        prevPost:
          i + 1 === numberOfPosts // If the current post is the oldest
            ? { data: '' }
            : allPosts[i + 1],
        // Next post
        nextPost:
          i === 0 // If the current post is the newest
            ? { data: '' }
            : allPosts[i - 1],
      },
    }))
}
interface Props {
  post: CollectionEntry<'dzho-i-charli'>
}
const { post } = Astro.props
const { title, desc, img, pubDate } = post.data
const { Content } = await post.render()

// —Å–ª–µ–¥—É—â–∏–µ –ø–æ—Å—Ç—ã –≤ –ø–æ—Å—Ç–µ
const { prevPost, nextPost } = Astro.props

const link_to_post = 'py-[4px] px-[12px] rounded-[8px] bg-white'
const active =
  'py-[4px] px-[12px] bg-white rounded-[8px] outline outline-[2px] outline-green-300'
---

<Post
  title={'–î–∂–æ –∏ –ß–∞—Ä–ª–∏ –∏–∑—É—á–µ–Ω–∏–µ –ë–ö–ê–ê - ' + title}
  desc={desc}
  poster={img}
  pubDate={pubDate}
>
  <main class="_content">
    <audio
      class="w-full mb-[20px]"
      controls
      src={'/speak-djo-charli/' + post.slug + '.mp3'}></audio>

    <div
      title="–ü–∞–Ω–µ–ª—å –ø–æ—Å—Ç–∞"
      class="mx-[-20px] mb-[20px] rounded-[10px] flex flex-wrap gap-[10px] justify-center lg:justify-between items-center py-[5px] pl-[10px] pr-[5px] bg-white lg:gap-[5px]"
    >
      <a href="/aa/dzho-i-charli/" class="p-[10px] hover:bg-slate-100 rounded-[5px]"
        >üîö –ù–∞–∑–∞–¥</a
      >
      <ReadingTime client:idle />
      <SpechPlayer />
    </div>

    <div id="spech-content">
      <Content />
    </div>

    <AsidePost title={title} />

    {
      post.slug === '11' ||
      post.slug === '19' ||
      post.slug === '29' ||
      post.slug === '38' ||
      post.slug === '44' ||
      post.slug === '51' ||
      post.slug === '77' ||
      post.slug === '98' ||
      post.slug === '102' ? (
        <>
          <hr class="bg-[#aaa] h-[1px] mt-[40px] mb-[20px]" />
          <div class="flex flex-wrap gap-[20px]">
            {post.slug === '11' ? (
              <a href="/aa/dzho-i-charli/#pre" class={active}>
                üìò –ü—Ä–µ–¥–∏—Å–ª–æ–≤–∏–µ
              </a>
            ) : (
              <a href="/aa/dzho-i-charli/#pre" class={link_to_post}>
                üìò –ü—Ä–µ–¥–∏—Å–ª–æ–≤–∏–µ
              </a>
            )}

            {post.slug === '19' ? (
              <a href="/aa/dzho-i-charli/#doctor" class={active}>
                üìï –ú–Ω–µ–Ω–∏–µ –¥–æ–∫—Ç–æ—Ä–∞
              </a>
            ) : (
              <a href="/aa/dzho-i-charli/#doctor" class={link_to_post}>
                üìï –ú–Ω–µ–Ω–∏–µ –¥–æ–∫—Ç–æ—Ä–∞
              </a>
            )}

            {post.slug === '29' ? (
              <a href="/aa/dzho-i-charli/#bill" class={active}>
                üìî –†–∞—Å—Å–∫–∞–∑ –ë–∏–ª–ª–∞
              </a>
            ) : (
              <a href="/aa/dzho-i-charli/#bill" class={link_to_post}>
                üìî –†–∞—Å—Å–∫–∞–∑ –ë–∏–ª–ª–∞
              </a>
            )}

            {post.slug === '38' ? (
              <a href="/aa/dzho-i-charli/#exit" class={active}>
                üìô –í—ã—Ö–æ–¥ –µ—Å—Ç—å
              </a>
            ) : (
              <a href="/aa/dzho-i-charli/#exit" class={link_to_post}>
                üìô –í—ã—Ö–æ–¥ –µ—Å—Ç—å
              </a>
            )}

            {post.slug === '44' ? (
              <a href="/aa/dzho-i-charli/#alc" class={active}>
                üçµ –ï—â–µ –æ–± –∞–ª–∫–æ–≥–æ–ª–∏–∑–º–µ
              </a>
            ) : (
              <a href="/aa/dzho-i-charli/#alc" class={link_to_post}>
                üçµ –ï—â–µ –æ–± –∞–ª–∫–æ–≥–æ–ª–∏–∑–º–µ
              </a>
            )}

            {post.slug === '51' ? (
              <a href="/aa/dzho-i-charli/#agnostic" class={active}>
                üõï –ê –∫–∞–∫ –±—ã—Ç—å –∞–≥–Ω–æ—Å—Ç–∏–∫–∞–º?
              </a>
            ) : (
              <a href="/aa/dzho-i-charli/#agnostic" class={link_to_post}>
                üõï –ê –∫–∞–∫ –±—ã—Ç—å –∞–≥–Ω–æ—Å—Ç–∏–∫–∞–º?
              </a>
            )}

            {post.slug === '77' ? (
              <a href="/aa/dzho-i-charli/#moving" class={active}>
                ‚õè –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤ –¥–µ–π—Å—Ç–≤–∏–∏
              </a>
            ) : (
              <a href="/aa/dzho-i-charli/#moving" class={link_to_post}>
                ‚õè –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤ –¥–µ–π—Å—Ç–≤–∏–∏
              </a>
            )}

            {post.slug === '98' ? (
              <a href="/aa/dzho-i-charli/#work" class={active}>
                üìó –ó–∞ —Ä–∞–±–æ—Ç—É!
              </a>
            ) : (
              <a href="/aa/dzho-i-charli/#work" class={link_to_post}>
                üìó –ó–∞ —Ä–∞–±–æ—Ç—É!
              </a>
            )}

            <a href="/aa/dzho-i-charli/#12step" class={link_to_post}>
              üìñ –†–∞–±–æ—Ç–∞—è —Å –¥—Ä—É–≥–∏–º–∏
            </a>
          </div>
        </>
      ) : (
        <>
          <PrevPosts {prevPost} {nextPost} link={'dzho-i-charli'} />
        </>
      )
    }
    <script lang="js">
      const audioElement = document.querySelector('audio') // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç <audio>
      const audioUrl = audioElement.getAttribute('src') // –ü–æ–ª—É—á–∞–µ–º URL-–∞–¥—Ä–µ—Å –∑–≤—É–∫–æ–≤–æ–π –∑–∞–ø–∏—Å–∏

      fetch(audioUrl)
        .then((response) => {
          if (!response.ok) {
            // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ –±—ã–ª –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ
            audioElement.remove() // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç <audio>
          }
        })
        .catch((error) => {
          audioElement.remove() // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç <audio>
        })
    </script>
  </main>
</Post>
